PLANEJAMENTO DETALHADO: SeleÃ§Ã£o de VersÃ£o + InstruÃ§Ãµes LLM

 1. INTERFACE - Modal de GeraÃ§Ã£o

 SpecificationGenerationModal - Campos em Ordem:

 interface GenerateSpecificationForm {
   // 1. Projeto (jÃ¡ selecionado, readonly)
   projectId: string;
   projectName: string;

   // 2. SESSÃƒO DE REQUISITOS (dropdown)
   requirementsSessionId: string;
   requirementsSessionName: string;
   // Lista: SELECT id, session_name, started_at FROM execution_sessions WHERE project_id = ?

   // 3. VERSÃƒO DOS REQUISITOS (dropdown dinÃ¢mico)
   requirementsVersion: number;
   // Lista: SELECT version, created_at, change_type, change_description 
   //        FROM session_requirements_version 
   //        WHERE session_id = ?
   // ExibiÃ§Ã£o: "VersÃ£o 1 (AnÃ¡lise inicial) - 03/12/2025"
   //           "VersÃ£o 2 (Refinamento: adicionar LGPD) - 04/12/2025"

   // 4. DOCUMENTOS COMPLEMENTARES (multiselect opcional)
   complementaryDocuments: string[];
   // Lista: SELECT id, name, type FROM documents WHERE project_id = ? AND status = 'analyzed'
   // Checkbox list com preview

   // 5. CONFIGURAÃ‡Ã•ES
   sessionName?: string;  // Nome para esta geraÃ§Ã£o
   detailLevel: 'basic' | 'detailed' | 'comprehensive';
   targetAudience: 'technical' | 'business' | 'mixed';
   includeDataModel: boolean;
   includeUseCases: boolean;
   includeBusinessRules: boolean;
   includeGlossary: boolean;

   // 6. INSTRUÃ‡Ã•ES CUSTOMIZADAS
   customInstructions?: string;
 }

 Wireframe do Modal:

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  Gerar EspecificaÃ§Ã£o Funcional                  â”‚
 â”‚                                                 â”‚
 â”‚  Projeto: [Sistema XYZ]                     ğŸ”’ â”‚
 â”‚                                                 â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
 â”‚  â”‚ ğŸ“„ Fonte de Requisitos                    â”‚ â”‚
 â”‚  â”‚                                           â”‚ â”‚
 â”‚  â”‚ SessÃ£o de Requisitos: *                  â”‚ â”‚
 â”‚  â”‚ [v] AnÃ¡lise Email - 03/12/2025           â”‚ â”‚
 â”‚  â”‚                                           â”‚ â”‚
 â”‚  â”‚ VersÃ£o dos Requisitos: *                 â”‚ â”‚
 â”‚  â”‚ [v] VersÃ£o 3 (Refinamento: LGPD) ğŸ“     â”‚ â”‚
 â”‚  â”‚     04/12/2025 - 58KB                    â”‚ â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
 â”‚                                                 â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
 â”‚  â”‚ ğŸ“š Documentos Complementares (opcional)   â”‚ â”‚
 â”‚  â”‚                                           â”‚ â”‚
 â”‚  â”‚ [ ] email_requirements.pdf (250KB)       â”‚ â”‚
 â”‚  â”‚ [ ] processo_atual.docx (120KB)          â”‚ â”‚
 â”‚  â”‚ [x] diagrama_fluxo.png (80KB)            â”‚ â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
 â”‚                                                 â”‚
 â”‚  âš™ï¸ ConfiguraÃ§Ãµes                               â”‚
 â”‚  NÃ­vel de Detalhe: [v] Detalhado              â”‚
 â”‚  PÃºblico-alvo: [v] Misto (tÃ©cnico + negÃ³cio)  â”‚
 â”‚                                                 â”‚
 â”‚  âœ… Incluir Modelo de Dados                    â”‚
 â”‚  âœ… Incluir Casos de Uso                       â”‚
 â”‚  âœ… Incluir Regras de NegÃ³cio                  â”‚
 â”‚  âœ… Incluir GlossÃ¡rio                          â”‚
 â”‚                                                 â”‚
 â”‚  âœï¸ InstruÃ§Ãµes Adicionais (opcional)           â”‚
 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
 â”‚  â”‚ Enfatizar aspectos de seguranÃ§a...       â”‚ â”‚
 â”‚  â”‚                                           â”‚ â”‚
 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
 â”‚                                                 â”‚
 â”‚                      [Cancelar]  [Gerar] âœ¨    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 2. PROMPT LLM - Estrutura Completa

 Template de Prompt com InstruÃ§Ãµes Claras:

 SPECIFICATION_GENERATION_PROMPT = """
 # CONTEXTO DA TAREFA
 VocÃª Ã© um analista de requisitos especializado em criar especificaÃ§Ãµes funcionais de alta qualidade conforme padrÃµes IEEE 830 e metodologias Ã¡geis.

 # DOCUMENTO DE REQUISITOS (FONTE PRINCIPAL)
 Esta Ã© a FONTE PRIMÃRIA de informaÃ§Ã£o. Use-a como base principal para a especificaÃ§Ã£o:

 ```markdown
 {requirements_document}

 VersÃ£o: {requirements_version}
 Tipo: {requirements_change_type}
 Data: {requirements_created_at}

 ---
 DOCUMENTOS COMPLEMENTARES

 {complementary_documents_section}

 ---
 INSTRUÃ‡Ã•ES DE USO DOS DOCUMENTOS

 DOCUMENTO DE REQUISITOS (Principal):

 - Este documento jÃ¡ contÃ©m requisitos estruturados e validados
 - Use-o como FONTE PRIMÃRIA para extrair:
   - Requisitos funcionais (FR-XXX)
   - Requisitos nÃ£o-funcionais (NFR-XXX)
   - Regras de negÃ³cio (BR-XXX)
   - Atores e stakeholders
   - Fluxos de trabalho identificados
 - Expanda e detalhe os requisitos jÃ¡ identificados
 - Mantenha rastreabilidade com os IDs originais quando presentes

 DOCUMENTOS COMPLEMENTARES (Contexto):

 {documents_usage_instructions}

 PRIORIDADE:

 1. REQUISITOS DOCUMENT = BASE PRINCIPAL (jÃ¡ validado e estruturado)
 2. COMPLEMENTARES = CONTEXTO ADICIONAL (detalhes, diagramas, exemplos)
 3. Em caso de conflito: Priorize o documento de requisitos, mas mencione divergÃªncias encontradas

 ---
 CONFIGURAÃ‡Ã•ES DA GERAÃ‡ÃƒO

 - NÃ­vel de Detalhe: {detail_level}
   - basic: VisÃ£o geral e requisitos principais
   - detailed: DescriÃ§Ãµes completas com critÃ©rios de aceitaÃ§Ã£o
   - comprehensive: Inclui casos de uso expandidos, diagramas detalhados
 - PÃºblico-alvo: {target_audience}
   - technical: Foco em arquitetura, APIs, estruturas de dados
   - business: Foco em processos, benefÃ­cios, casos de uso
   - mixed: Balancear aspectos tÃ©cnicos e de negÃ³cio
 - Incluir Modelo de Dados: {include_data_model}
 - Incluir Casos de Uso: {include_use_cases}
 - Incluir Regras de NegÃ³cio: {include_business_rules}
 - Incluir GlossÃ¡rio: {include_glossary}

 {custom_instructions_section}

 ---
 ESTRUTURA DO DOCUMENTO A GERAR

 1. INTRODUÃ‡ÃƒO

 1.1 PropÃ³sito

 1.2 Escopo

 1.3 DefiniÃ§Ãµes, AcrÃ´nimos e AbreviaÃ§Ãµes

 1.4 ReferÃªncias

 - Documento de Requisitos (VersÃ£o {requirements_version})
 {complementary_references}
 1.5 VisÃ£o Geral do Documento

 2. DESCRIÃ‡ÃƒO GERAL DO SISTEMA

 2.1 Contexto do NegÃ³cio

 2.2 Objetivos do Sistema

 2.3 Arquitetura Conceitual

 2.4 Principais Funcionalidades

 2.5 UsuÃ¡rios e Stakeholders

 3. REQUISITOS FUNCIONAIS

 Para CADA requisito funcional do documento de requisitos:
 - [FR-XXX] Nome do Requisito
 - Fonte: Req-Doc versÃ£o {requirements_version} {additional_sources}
 - DescriÃ§Ã£o Detalhada: ...
 - Prioridade: Must/Should/Could/Won't Have
 - Complexidade: Low/Medium/High
 - Atores: ...
 - PrÃ©-condiÃ§Ãµes: ...
 - Fluxo Principal:
   a. ...
 - CritÃ©rios de AceitaÃ§Ã£o:
   - ...
 - DependÃªncias: ...
 {if include_use_cases}
 - Casos de Uso Relacionados: UC-XXX
 {endif}

 4. REQUISITOS NÃƒO-FUNCIONAIS

 Para CADA NFR:
 - [NFR-XXX] Nome
 - Categoria: Performance/Security/Usability/...
 - Fonte: Req-Doc versÃ£o {requirements_version}
 - MÃ©trica: Como medir
 - Valor Alvo: ...
 - MÃ©todo de Teste: ...

 {if include_data_model}
 5. MODELO DE DADOS

 5.1 Diagrama Entidade-Relacionamento

 erDiagram
     [GERAR BASEADO NOS REQUISITOS]

 5.2 DicionÃ¡rio de Dados

 Para cada entidade identificada nos requisitos...
 {endif}

 {if include_use_cases}
 6. CASOS DE USO

 Para cada caso de uso expandido...
 {endif}

 7. FLUXOS DE TRABALHO

 graph TD
     [GERAR FLUXOS DOS PROCESSOS IDENTIFICADOS]

 {if include_business_rules}
 8. REGRAS DE NEGÃ“CIO

 Para cada BR identificada nos requisitos...
 {endif}

 9. INTEGRAÃ‡Ã•ES

 Sistemas externos identificados...

 10. CONSIDERAÃ‡Ã•ES DE ARQUITETURA

 10.1 Componentes Principais

 10.2 PadrÃµes Arquiteturais

 10.3 Tecnologias Recomendadas

 {if include_glossary}
 11. GLOSSÃRIO

 Termos tÃ©cnicos e de domÃ­nio...
 {endif}

 ---
 DIRETRIZES CRÃTICAS

 1. RASTREABILIDADE: Sempre referencie a origem (Req-Doc v{requirements_version}, Doc Complementar X)
 2. CONSISTÃŠNCIA: Use IDs dos requisitos quando jÃ¡ existirem
 3. COMPLETUDE: Expanda requisitos bÃ¡sicos com detalhes tÃ©cnicos
 4. CLAREZA: Linguagem sem ambiguidades
 5. MENSURABILIDADE: CritÃ©rios de aceitaÃ§Ã£o devem ser verificÃ¡veis
 6. INTEGRAÃ‡ÃƒO: Cruze informaÃ§Ãµes de requisitos + complementares
 7. CONFLITOS: Se houver divergÃªncia entre docs, mencione explicitamente

 FORMATO DE SAÃDA

 Retorne SOMENTE o documento em Markdown.
 Sem meta-comentÃ¡rios, sem introduÃ§Ãµes explicativas.
 Comece diretamente com:

 EspecificaÃ§Ã£o Funcional: {project_name}

 VersÃ£o: 1.0
 Data: {generation_date}
 Baseado em: Documento de Requisitos v{requirements_version}

 ...
 """

 ### SeÃ§Ãµes DinÃ¢micas do Prompt:

 **complementary_documents_section:**
 DOCUMENTOS COMPLEMENTARES

 {if has_complementary_docs}
 Os seguintes documentos fornecem CONTEXTO ADICIONAL e DETALHES complementares:

 Documento 1: {doc1_name}

 Tipo: {doc1_type}
 PropÃ³sito: {doc1_purpose}
 ConteÃºdo:
 {doc1_content}

 Documento 2: {doc2_name}

 ...

 {else}
 Nenhum documento complementar foi fornecido. Use apenas o documento de requisitos.
 {endif}

 **documents_usage_instructions:**
 {if has_complementary_docs}
 - Use documentos complementares para:
   - Enriquecer descriÃ§Ãµes de funcionalidades
   - Adicionar exemplos concretos
   - Incluir diagramas e fluxos visuais
   - Complementar regras de negÃ³cio
   - Adicionar casos de uso nÃ£o documentados nos requisitos
 - NÃƒO substitua requisitos jÃ¡ documentados
 - NÃƒO altere prioridades ou escopo definidos
 - Mencione quando adicionar informaÃ§Ã£o de fonte complementar: "(Fonte: {doc_name})"
 {else}
 - Expanda os requisitos com base em boas prÃ¡ticas
 - Infira detalhes tÃ©cnicos necessÃ¡rios
 - Mantenha coerÃªncia com o contexto apresentado
 {endif}

 **custom_instructions_section:**
 {if has_custom_instructions}
 INSTRUÃ‡Ã•ES ADICIONAIS DO USUÃRIO

 O usuÃ¡rio solicitou especialmente:

 {custom_instructions}

 Incorpore estas instruÃ§Ãµes na geraÃ§Ã£o, priorizando quando relevantes.
 {endif}

 ## 3. BACKEND - Montagem do Prompt

 ```python
 async def execute_specification_generation(
     specification_session_id: str,
     requirements_session_id: str,
     requirements_version: int,
     complementary_document_ids: List[str],
     project_id: str,
     user_id: str,
     config: dict
 ):
     # 1. Buscar versÃ£o especÃ­fica de requisitos
     requirements_data = await get_requirements_version(
         requirements_session_id,
         requirements_version
     )

     # 2. Buscar documentos complementares
     complementary_docs = []
     if complementary_document_ids:
         for doc_id in complementary_document_ids:
             doc = await get_document(doc_id)
             complementary_docs.append({
                 'name': doc.name,
                 'type': doc.type,
                 'content': doc.content[:50000],  # Limite
                 'purpose': infer_document_purpose(doc)
             })

     # 3. Montar seÃ§Ãµes dinÃ¢micas
     complementary_section = build_complementary_section(complementary_docs)
     usage_instructions = build_usage_instructions(complementary_docs)
     custom_section = build_custom_section(config.get('custom_instructions'))

     # 4. Montar prompt completo
     prompt = SPECIFICATION_GENERATION_PROMPT.format(
         requirements_document=requirements_data['document'],
         requirements_version=requirements_version,
         requirements_change_type=requirements_data['change_type'],
         requirements_created_at=requirements_data['created_at'],
         complementary_documents_section=complementary_section,
         documents_usage_instructions=usage_instructions,
         custom_instructions_section=custom_section,
         detail_level=config['detail_level'],
         target_audience=config['target_audience'],
         include_data_model=config['include_data_model'],
         include_use_cases=config['include_use_cases'],
         include_business_rules=config['include_business_rules'],
         include_glossary=config['include_glossary'],
         project_name=project.name,
         generation_date=datetime.now().strftime('%d/%m/%Y'),
         # ... outros campos
     )

     # 5. Chamar LLM
     result = await call_llm(prompt, model='gpt-4-turbo')

     # 6. Salvar
     await save_specification(specification_session_id, result)
     await save_specification_version(specification_session_id, 1, result)

 4. RESUMO

 SeleÃ§Ã£o de VersÃ£o:

 âœ… Onde: Modal de geraÃ§Ã£o (dropdown "VersÃ£o dos Requisitos")
 âœ… Como: Lista todas versÃµes de session_requirements_version
 âœ… Exibe: "VersÃ£o X (tipo) - data - tamanho"

 InstruÃ§Ãµes LLM:

 âœ… Documento Requisitos: Fonte PRINCIPAL (base estruturada)
 âœ… Documentos Complementares: Contexto ADICIONAL (enriquecer)
 âœ… Prioridade: Requisitos > Complementares
 âœ… Rastreabilidade: Sempre indicar fonte de cada informaÃ§Ã£o
 âœ… Conflitos: Mencionar divergÃªncias explicitamente
